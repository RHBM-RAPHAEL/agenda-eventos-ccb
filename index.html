<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Agenda de Eventos</title>
  <style>
    /* Seu CSS continua igual */
  </style>
</head>
<body>

<div class="container">
  <h1>Agenda de Eventos</h1>

  <input type="text" id="titulo" placeholder="T√≠tulo do Evento">
  <input type="date" id="data">
  <input type="time" id="horaTermino">
  <input type="text" id="local" placeholder="Local do Evento">
  <textarea id="descricao" placeholder="Descri√ß√£o do Evento"></textarea>
  <input type="password" id="senha" placeholder="Senha para Edi√ß√£o/Exclus√£o">
  <button id="btnSalvar">Salvar Evento</button>
  <button id="btnMostrar">Mostrar Eventos</button>

  <div id="eventos"></div> <!-- ID corrigido aqui -->
</div>

<script type="module">
  // Firebase e Fun√ß√µes
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
  import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, updateDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCe3EqDWGXF9cR8mzCrOb_yryaWzsCuRaM",
    authDomain: "agenda-eventos-ccb.firebaseapp.com",
    projectId: "agenda-eventos-ccb",
    storageBucket: "agenda-eventos-ccb.appspot.com",
    messagingSenderId: "325923477189",
    appId: "1:325923477189:web:1aba52c8119d290338c2ac",
    measurementId: "G-PDTYLHH85J"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  async function salvarEvento(titulo, data, local, descricao, senha, horaTermino) {
    try {
      await addDoc(collection(db, "eventos"), { titulo, data, local, descricao, senha, horaTermino });
      alert("‚úÖ Evento salvo com sucesso!");
    } catch (error) {
      console.error("Erro ao salvar evento:", error);
      alert("‚ùå Erro ao salvar o evento.");
    }
  }

  function mostrarEventos() {
    const listaEventos = document.getElementById("eventos"); // ID corrigido para "eventos"
    listaEventos.innerHTML = ""; // Limpar antes de adicionar novos eventos

    getDocs(collection(db, "eventos"))
      .then((querySnapshot) => {
        querySnapshot.forEach((docSnap) => {
          const evento = docSnap.data();
          const li = document.createElement("li");
          li.innerHTML = `
            <strong>${evento.titulo}</strong><br>
            üìÖ ${evento.data} ‚Äì ‚è∞ At√© ${evento.horaTermino}<br>
            üìç ${evento.local}<br>
            üìù ${evento.descricao}<br>
            <button class="editar" data-id="${docSnap.id}">‚úèÔ∏è Editar</button>
            <button class="excluir" data-id="${docSnap.id}">üóëÔ∏è Excluir</button>
            <hr>
          `;
          listaEventos.appendChild(li);
        });

        // Adicionar eventos de click para os bot√µes de editar e excluir
        document.querySelectorAll(".excluir").forEach((btn) => {
          btn.addEventListener("click", () => {
            const id = btn.getAttribute("data-id");
            const senha = prompt("Digite a senha para excluir:");
            if (senha === "1234") {
              excluirEvento(id);
            } else {
              alert("‚ùå Senha incorreta.");
            }
          });
        });

        document.querySelectorAll(".editar").forEach((btn) => {
          btn.addEventListener("click", () => {
            const id = btn.getAttribute("data-id");
            const senha = prompt("Digite a senha para editar:");
            if (senha === "1234") {
              editarEvento(id);
            } else {
              alert("‚ùå Senha incorreta.");
            }
          });
        });
      })
      .catch((error) => {
        console.error("Erro ao mostrar eventos:", error);
      });
  }

  async function excluirEvento(id) {
    const eventoRef = doc(db, "eventos", id);
    const eventoSnap = await getDoc(eventoRef);

    if (!eventoSnap.exists()) {
      alert("Evento n√£o encontrado.");
      return;
    }

    const evento = eventoSnap.data();
    const senhaDigitada = prompt("Digite a senha para excluir este evento:");

    if (senhaDigitada === evento.senha) {
      if (confirm("Tem certeza que deseja excluir este evento?")) {
        await deleteDoc(eventoRef);
        alert("üóëÔ∏è Evento exclu√≠do com sucesso!");
        mostrarEventos();
      }
    } else {
      alert("‚ùå Senha incorreta. N√£o foi poss√≠vel excluir o evento.");
    }
  }

  async function editarEvento(id) {
    const eventoRef = doc(db, "eventos", id);
    const eventoSnap = await getDoc(eventoRef);

    if (!eventoSnap.exists()) {
      alert("Evento n√£o encontrado.");
      return;
    }

    const evento = eventoSnap.data();
    const senhaDigitada = prompt("Digite a senha para editar:");

    if (senhaDigitada === evento.senha) {
      const novoTitulo = prompt("Novo t√≠tulo:", evento.titulo);
      const novaData = prompt("Nova data:", evento.data);
      const novoLocal = prompt("Novo local:", evento.local);
      const novaDescricao = prompt("Nova descri√ß√£o:", evento.descricao);
      const novaHoraTermino = prompt("Nova hora de t√©rmino:", evento.horaTermino);

      if (novoTitulo && novaData && novoLocal && novaDescricao && novaHoraTermino) {
        await updateDoc(eventoRef, {
          titulo: novoTitulo,
          data: novaData,
          local: novoLocal,
          descricao: novaDescricao,
          horaTermino: novaHoraTermino
        });
        alert("‚úèÔ∏è Evento atualizado!");
        mostrarEventos();
      }
    } else {
      alert("‚ùå Senha incorreta. N√£o foi poss√≠vel editar o evento.");
    }
  }

  document.getElementById("btnSalvar").addEventListener("click", () => {
    const titulo = document.getElementById("titulo").value;
    const data = document.getElementById("data").value;
    const horaTermino = document.getElementById("horaTermino").value;
    const local = document.getElementById("local").value;
    const descricao = document.getElementById("descricao").value;
    const senha = document.getElementById("senha").value;

    if (!titulo || !data || !horaTermino || !local || !descricao || !senha) {
      alert("Preencha todos os campos.");
      return;
    }

    salvarEvento(titulo, data, local, descricao, senha, horaTermino);
  });

  document.getElementById("btnMostrar").addEventListener("click", mostrarEventos);

  // Deixando fun√ß√µes globais
  window.excluirEvento = excluirEvento;
  window.editarEvento = editarEvento;
</script>

<footer style="background-color: #3100ff; padding: 20px; text-align: center; font-size: 14px;">
  <p>&copy; 2025 Agenda CCB | Raphael Henrique</p>
  <p><strong>Agenda CCB</strong> √© um projeto desenvolvido como atividade extensionista do curso de Engenharia de Software.</p>
  <p>O objetivo √© divulgar eventos Religiosos locais, como: Reuni√µes de adora√ß√£o, apresenta√ß√µes e encontros comunit√°rios.</p>
  <p>Esta p√°gina foi criada por Raphael Henrique, com o uso de tecnologias web como HTML, CSS e JavaScript.</p>
  <p>Projeto acad√™mico - 2025</p>
</footer>
</body>
</html>
